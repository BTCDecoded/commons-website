<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;">
    <title>The Bitcoin Commons - Coordination Without Authority: An Architectural Solution</title>
    <meta name="description" content="A forkable governance model for Bitcoin implementations. Coordination without authority through proven commons management principles.">
    
    <!-- Open Graph -->
    <meta property="og:title" content="The Bitcoin Commons - Coordination Without Authority">
    <meta property="og:description" content="A forkable governance model for Bitcoin implementations. Coordination without authority through proven commons management principles.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thebitcoincommons.org">
    <meta property="og:image" content="https://thebitcoincommons.org/assets/og-image.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The Bitcoin Commons - Coordination Without Authority">
    <meta name="twitter:description" content="A forkable governance model for Bitcoin implementations. Coordination without authority through proven commons management principles.">
    <meta name="twitter:image" content="https://thebitcoincommons.org/assets/og-image.png">
    
    <link rel="stylesheet" href="style.css?v=3">
    <style>
        /* Critical fork governance styles - ensure they load */
        .fork-governance-section {
            padding: 4rem 0 !important;
            background-color: var(--bg-secondary) !important;
            border-top: 1px solid var(--border-color) !important;
            display: block !important;
        }
        .fork-tabs {
            display: flex !important;
            gap: 1rem !important;
            margin-bottom: 2rem !important;
            border-bottom: 2px solid var(--border-color) !important;
            flex-wrap: wrap !important;
        }
        .fork-tab {
            padding: 1rem 1.5rem !important;
            background: none !important;
            border: none !important;
            border-bottom: 3px solid transparent !important;
            font-size: 1rem !important;
            font-weight: 500 !important;
            color: var(--text-secondary) !important;
            cursor: pointer !important;
        }
        .fork-tab.active {
            color: var(--bitcoin-orange) !important;
            border-bottom-color: var(--bitcoin-orange) !important;
        }
        .fork-tab-content {
            display: none !important;
        }
        .fork-tab-content.active {
            display: block !important;
        }
        .marketplace-header, .templates-header, .compare-header {
            text-align: center !important;
            margin-bottom: 2rem !important;
        }
        .fork-cards-grid {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;
            gap: 1.5rem !important;
            margin-bottom: 2rem !important;
        }
        .fork-card {
            background-color: var(--bg-primary) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 1.5rem !important;
        }
        .template-grid {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
            gap: 2rem !important;
            margin-bottom: 2rem !important;
        }
        .template-card {
            background-color: var(--bg-primary) !important;
            border: 2px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 2rem !important;
            text-align: center !important;
        }
        .fork-tool-container {
            background-color: var(--bg-primary) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            padding: 2rem !important;
            margin-bottom: 3rem !important;
        }
        .fork-tool-content {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 2rem !important;
        }
        .parameter-group {
            padding: 1.5rem !important;
            background-color: var(--bg-secondary) !important;
            border-radius: 6px !important;
            border: 1px solid var(--border-color) !important;
        }
    </style>
</head>
<body>
    <header class="hero">
        <div class="hero-background">
            <img src="assets/commons.jpg" alt="Ancient commons with Bitcoin as the sun" class="hero-image">
        </div>
        <div class="hero-content">
            <a href="index.html"><img src="assets/bitcoin-commons-logo.png" alt="Bitcoin Commons Logo" class="logo"></a>
            <div class="container">
                <h1>The Bitcoin Commons</h1>
                <h2>Coordination Without Authority: An Architectural Solution</h2>
                <p class="tagline">A forkable governance model for Bitcoin implementations</p>
                <p class="subtagline">Applying proven commons management principles to Bitcoin's development layer</p>
                
                <div class="cta-buttons">
                    <a href="whitepaper.html" class="btn btn-primary">Read White Paper</a>
                    <a href="https://docs.thebitcoincommons.org" class="btn btn-secondary" target="_blank" rel="noopener">Documentation</a>
                    <a href="assets/bitcoin-commons-whitepaper.pdf" class="btn btn-secondary" download>Download PDF</a>
                    <a href="assets/bitcoin-commons-whitepaper.epub" class="btn btn-secondary" download>Download EPUB</a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="value-props">
            <div class="container">
                <h2>Why Bitcoin Commons</h2>
                <div class="columns">
                    <div class="column">
                        <h3>Modular Architecture</h3>
                        <p>Decentralized governance through composable modules, enabling competitive discovery and user sovereignty without consensus layer changes.</p>
                    </div>
                    <div class="column">
                        <h3>Economic Sustainability</h3>
                        <p>Self-funding through merge mining revenue, creating economic alignment between miners and development priorities without external dependencies.</p>
                    </div>
                    <div class="column">
                        <h3>Proven Governance Principles</h3>
                        <p>Based on Elinor Ostrom's Nobel Prize-winning research on commons governance, enforced through Bitcoin's cryptographic primitives.</p>
                    </div>
                </div>
                
                <div class="framework-visual">
                    <div class="framework-visual-wrapper">
                        <img src="assets/images/centralized-vs-decentralized.png" alt="Centralized vs Decentralized Governance">
                    </div>
                    <p class="diagram-caption">Bitcoin Commons moves governance from centralized control (few maintainers, single point of failure) to decentralized, forkable governance (distributed maintainers, multiple implementations, user choice). This architectural shift makes capture structurally difficult.</p>
                </div>
            </div>
        </section>

        <section class="implementations">
            <div class="container">
                <h2>Implementations</h2>
                <p>Multiple implementations using the Bitcoin Commons framework. Each maintains its own governance while sharing common principles.</p>
                
                <div class="implementation-cards">
                    <div class="implementation-card">
                        <h3>BTCDecoded</h3>
                        <p>Complete 6-tier implementation stack with formal governance infrastructure. First implementation of Bitcoin Commons.</p>
                        <div class="implementation-links">
                            <a href="https://btcdecoded.org" target="_blank" rel="noopener" class="btn btn-outline">Website</a>
                            <a href="https://btcdecoded.org#download" target="_blank" rel="noopener" class="btn btn-outline">Downloads</a>
                            <a href="https://github.com/BTCDecoded" target="_blank" rel="noopener" class="btn btn-outline">GitHub</a>
                        </div>
                    </div>
                    
                    <div class="implementation-card coming-soon-card">
                        <h3>Your Implementation</h3>
                        <p>Build your own Bitcoin implementation using the Bitcoin Commons governance framework. Fork the governance model and customize for your organization.</p>
                        <a href="https://github.com/BTCDecoded/governance" target="_blank" rel="noopener" class="btn btn-secondary">Learn How to Adopt</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="fork-governance" class="fork-governance-section">
            <div class="container">
                <h2>Fork Your Governance</h2>
                <p class="section-intro">Code is a commons. Forking should be as natural as breathing. Browse existing forks, start from a template, or create your own‚Äîall in one click.</p>
                
                <!-- Fork Marketplace Tabs -->
                <div class="fork-tabs">
                    <button class="fork-tab active" data-tab="marketplace">Browse Forks</button>
                    <button class="fork-tab" data-tab="templates">Start from Template</button>
                    <button class="fork-tab" data-tab="custom">Custom Fork</button>
                    <button class="fork-tab" data-tab="genealogy">Fork Genealogy</button>
                    <button class="fork-tab" data-tab="compare">Compare Forks</button>
                </div>
                
                <!-- Fork Marketplace -->
                <div id="marketplace-tab" class="fork-tab-content active">
                    <div class="marketplace-header">
                        <h3>Governance Fork Marketplace</h3>
                        <p>Discover forks created by the community. See adoption stats, compare features, and fork with one click.</p>
                    </div>
                    
                    <div class="marketplace-filters">
                        <input type="text" id="fork-search" placeholder="Search forks..." class="search-input">
                        <select id="fork-sort" class="sort-select">
                            <option value="popular">Most Popular</option>
                            <option value="recent">Recently Created</option>
                            <option value="adoption">Highest Adoption</option>
                            <option value="conservative">Most Conservative</option>
                            <option value="progressive">Most Progressive</option>
                        </select>
                    </div>
                    
                    <div class="fork-cards-grid" id="fork-cards">
                        <!-- Fork cards will be populated by JavaScript from registry -->
                        <div class="fork-loading" style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--text-secondary);">
                            Loading forks from registry...
                        </div>
                    </div>
                </div>
                
                <!-- Templates Tab -->
                <div id="templates-tab" class="fork-tab-content">
                    <div class="templates-header">
                        <h3>Start from a Template</h3>
                        <p>Choose a pre-configured governance model. One click to fork, customize later if needed.</p>
                    </div>
                    
                    <div class="template-grid">
                        <div class="template-card" data-template="conservative">
                            <div class="template-icon">üõ°Ô∏è</div>
                            <h4>Conservative</h4>
                            <p>Maximum security with higher thresholds</p>
                            <ul class="template-features">
                                <li>Tier 1: 4-of-5 signatures, 14 days</li>
                                <li>Tier 2: 5-of-5 signatures, 60 days</li>
                                <li>Tier 3: 6-of-7 signatures, 180 days</li>
                                <li>Economic veto: 25% threshold</li>
                            </ul>
                            <button class="btn btn-primary template-fork-btn">Fork This Template</button>
                        </div>
                        
                        <div class="template-card" data-template="balanced">
                            <div class="template-icon">‚öñÔ∏è</div>
                            <h4>Balanced (Default)</h4>
                            <p>Standard Bitcoin Commons model</p>
                            <ul class="template-features">
                                <li>Tier 1: 3-of-5 signatures, 7 days</li>
                                <li>Tier 2: 4-of-5 signatures, 30 days</li>
                                <li>Tier 3: 5-of-5 signatures, 90 days</li>
                                <li>Economic veto: 30% threshold</li>
                            </ul>
                            <button class="btn btn-primary template-fork-btn">Fork This Template</button>
                        </div>
                        
                        <div class="template-card" data-template="agile">
                            <div class="template-icon">‚ö°</div>
                            <h4>Agile</h4>
                            <p>Faster iteration for experimentation</p>
                            <ul class="template-features">
                                <li>Tier 1: 2-of-3 signatures, 3 days</li>
                                <li>Tier 2: 3-of-5 signatures, 14 days</li>
                                <li>Tier 3: 4-of-5 signatures, 60 days</li>
                                <li>Economic veto: 35% threshold</li>
                            </ul>
                            <button class="btn btn-primary template-fork-btn">Fork This Template</button>
                        </div>
                        
                        <div class="template-card" data-template="community">
                            <div class="template-icon">üë•</div>
                            <h4>Community-Driven</h4>
                            <p>Lower veto threshold, more network power</p>
                            <ul class="template-features">
                                <li>Tier 1: 3-of-5 signatures, 7 days</li>
                                <li>Tier 2: 4-of-5 signatures, 30 days</li>
                                <li>Tier 3: 5-of-5 signatures, 90 days</li>
                                <li>Economic veto: 20% threshold</li>
                            </ul>
                            <button class="btn btn-primary template-fork-btn">Fork This Template</button>
                        </div>
                    </div>
                </div>
                
                <!-- Custom Fork Tab (existing) -->
                <div id="custom-tab" class="fork-tab-content">
                <div class="fork-tool-container">
                    <div class="fork-tool-header">
                        <h3>Customize Governance Ruleset</h3>
                        <p>Adjust parameters below to create your custom governance model. All changes maintain Bitcoin consensus compatibility.</p>
                    </div>
                    
                    <div class="fork-tool-content">
                        <div class="fork-parameters">
                            <div class="parameter-group">
                                <h4>Tier 1: Routine Maintenance</h4>
                                <div class="parameter-control">
                                    <label>Signature Threshold</label>
                                    <select id="tier1-signatures" class="param-select">
                                        <option value="2-of-3">2-of-3</option>
                                        <option value="3-of-5" selected>3-of-5 (Default)</option>
                                        <option value="4-of-5">4-of-5</option>
                                        <option value="5-of-5">5-of-5</option>
                                    </select>
                                </div>
                                <div class="parameter-control">
                                    <label>Review Period (days)</label>
                                    <input type="number" id="tier1-review" class="param-input" value="7" min="1" max="30">
                                </div>
                            </div>
                            
                            <div class="parameter-group">
                                <h4>Tier 2: Feature Changes</h4>
                                <div class="parameter-control">
                                    <label>Signature Threshold</label>
                                    <select id="tier2-signatures" class="param-select">
                                        <option value="3-of-5">3-of-5</option>
                                        <option value="4-of-5" selected>4-of-5 (Default)</option>
                                        <option value="5-of-5">5-of-5</option>
                                    </select>
                                </div>
                                <div class="parameter-control">
                                    <label>Review Period (days)</label>
                                    <input type="number" id="tier2-review" class="param-input" value="30" min="7" max="90">
                                </div>
                            </div>
                            
                            <div class="parameter-group">
                                <h4>Tier 3: Consensus-Adjacent</h4>
                                <div class="parameter-control">
                                    <label>Signature Threshold</label>
                                    <select id="tier3-signatures" class="param-select">
                                        <option value="4-of-5">4-of-5</option>
                                        <option value="5-of-5" selected>5-of-5 (Default)</option>
                                        <option value="6-of-7">6-of-7</option>
                                    </select>
                                </div>
                                <div class="parameter-control">
                                    <label>Review Period (days)</label>
                                    <input type="number" id="tier3-review" class="param-input" value="90" min="30" max="180">
                                </div>
                                <div class="parameter-control">
                                    <label>Economic Node Veto Threshold (%)</label>
                                    <input type="number" id="tier3-veto" class="param-input" value="30" min="20" max="50" step="5">
                                </div>
                            </div>
                            
                            <div class="parameter-group">
                                <h4>Repository Selection</h4>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Select which repository to fork. Only one repository can be selected.</p>
                                <div class="repo-selection">
                                    <label class="repo-checkbox-label">
                                        <input type="radio" name="fork-repo" value="governance" class="repo-checkbox" checked>
                                        <span class="repo-checkbox-text">
                                            <strong>governance</strong>
                                            <span class="repo-desc">Governance configuration and rules</span>
                                        </span>
                                    </label>
                                    <label class="repo-checkbox-label">
                                        <input type="radio" name="fork-repo" value="bllvm-commons" class="repo-checkbox">
                                        <span class="repo-checkbox-text">
                                            <strong>bllvm-commons</strong>
                                            <span class="repo-desc">Cryptographic enforcement GitHub App</span>
                                        </span>
                                    </label>
                                    <label class="repo-checkbox-label">
                                        <input type="radio" name="fork-repo" value="bllvm-sdk" class="repo-checkbox">
                                        <span class="repo-checkbox-text">
                                            <strong>bllvm-sdk</strong>
                                            <span class="repo-desc">Developer toolkit and governance primitives</span>
                                        </span>
                                    </label>
                                    <label class="repo-checkbox-label">
                                        <input type="radio" name="fork-repo" value="bllvm-node" class="repo-checkbox">
                                        <span class="repo-checkbox-text">
                                            <strong>bllvm-node</strong>
                                            <span class="repo-desc">Full Bitcoin node library</span>
                                        </span>
                                    </label>
                                    <label class="repo-checkbox-label">
                                        <input type="radio" name="fork-repo" value="bllvm" class="repo-checkbox">
                                        <span class="repo-checkbox-text">
                                            <strong>bllvm</strong>
                                            <span class="repo-desc">Binary wrapper for bllvm-node</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="parameter-group">
                                <h4>Ruleset Metadata</h4>
                                <div class="parameter-control">
                                    <label>Ruleset Name</label>
                                    <input type="text" id="ruleset-name" class="param-input" placeholder="my-custom-governance" value="custom-governance-v1">
                                </div>
                                <div class="parameter-control">
                                    <label>Version</label>
                                    <input type="text" id="ruleset-version" class="param-input" placeholder="1.0.0" value="1.0.0" pattern="\d+\.\d+\.\d+">
                                </div>
                                <div class="parameter-control">
                                    <label>Description</label>
                                    <textarea id="ruleset-description" class="param-textarea" rows="3" placeholder="Custom governance ruleset for..."></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="fork-preview">
                            <h4>Ruleset Preview</h4>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.25rem; line-height: 1.6;">Your custom governance ruleset will appear below. Adjust the parameters on the left to see changes in real-time.</p>
                            <div class="preview-content">
                                <pre id="ruleset-preview" class="ruleset-preview-code">Loading preview...</pre>
                            </div>
                            <div class="fork-actions">
                                <button id="export-yaml" class="btn btn-primary">Export as YAML</button>
                                <button id="export-json" class="btn btn-secondary">Export as JSON</button>
                                <button id="download-ruleset" class="btn btn-outline">Download Ruleset</button>
                                <button id="share-fork" class="btn btn-primary" style="margin-top: 0.5rem; width: 100%;">Share This Fork to the Commons</button>
                            </div>
                            <div class="fork-info">
                                <p><strong>What happens next?</strong></p>
                                <ol>
                                    <li>Download your custom ruleset file</li>
                                    <li>Configure your Bitcoin node with <code>--governance-ruleset=custom</code></li>
                                    <li>Point to your ruleset file</li>
                                    <li>Your node will validate Bitcoin consensus while using your governance rules</li>
                                </ol>
                                <p class="fork-note">üí° <strong>Remember:</strong> Governance forks don't affect Bitcoin consensus. All nodes validate the same blockchain, but use different governance rules for development decisions.</p>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                
                <!-- Fork Genealogy Tab -->
                <div id="genealogy-tab" class="fork-tab-content">
                    <div class="genealogy-header">
                        <h3>Fork Genealogy Tree</h3>
                        <p>Visualize how governance forks relate to each other. See the evolution of the commons.</p>
                    </div>
                    
                    <div class="genealogy-controls">
                        <button id="genealogy-refresh" class="btn btn-outline">Refresh from Registry</button>
                        <span class="genealogy-status" id="genealogy-status">Loading forks from registry...</span>
                    </div>
                    
                    <div class="genealogy-container" id="genealogy-tree">
                        <!-- Genealogy tree will be rendered here by JavaScript -->
                        <div class="genealogy-loading">Loading fork genealogy...</div>
                    </div>
                    
                    <div class="genealogy-legend">
                        <h4>Legend</h4>
                        <div class="legend-items">
                            <div class="legend-item">
                                <span class="legend-color default"></span>
                                <span>Default/Root Fork</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color template"></span>
                                <span>Template Fork</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color community"></span>
                                <span>Community Fork</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color verified"></span>
                                <span>Verified Fork</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Compare Forks Tab -->
                <div id="compare-tab" class="fork-tab-content">
                    <div class="compare-header">
                        <h3>Compare Governance Forks</h3>
                        <p>Side-by-side comparison of different governance models. See differences at a glance.</p>
                    </div>
                    
                    <div class="compare-selectors">
                        <select id="compare-fork1" class="compare-select">
                            <option value="">Loading forks...</option>
                        </select>
                        <span class="compare-vs">vs</span>
                        <select id="compare-fork2" class="compare-select">
                            <option value="">Loading forks...</option>
                        </select>
                    </div>
                    
                    <div class="compare-table" id="compare-results">
                        <!-- Comparison table will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="fork-explanation">
                    <h3>How Governance Forking Works</h3>
                    <div class="explanation-grid">
                        <div class="explanation-item">
                            <h4>1. Export Current Ruleset</h4>
                            <p>Download the current governance configuration as a versioned, signed package. This includes all tiers, maintainers, and economic node settings.</p>
                        </div>
                        <div class="explanation-item">
                            <h4>2. Customize Parameters</h4>
                            <p>Modify signature thresholds, review periods, or economic node veto requirements to match your organization's needs. Bitcoin consensus remains unchanged.</p>
                        </div>
                        <div class="explanation-item">
                            <h4>3. Deploy Your Fork</h4>
                            <p>Configure your Bitcoin node to use your custom ruleset. Your node validates the same Bitcoin blockchain but uses your governance rules for development decisions.</p>
                        </div>
                        <div class="explanation-item">
                            <h4>4. Maintain Compatibility</h4>
                            <p>All governance forks maintain Bitcoin consensus compatibility. Users can switch between rulesets without re-syncing the blockchain. Multiple governance models can coexist.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="faq" class="faq-section">
            <div class="container">
                <h2>Frequently Asked Questions</h2>
                
                <div class="faq-categories">
                    <!-- Category 0: Top 5 Most Asked Questions -->
                    <div class="faq-category">
                        <h3>Top 5 Most Asked Questions</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What is Bitcoin Commons?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Commons is a project that solves Bitcoin's governance asymmetry through two complementary innovations: BLLVM (the technical stack providing mathematical rigor) and Bitcoin Commons (the governance framework providing coordination without civil war). Together, they enable safe alternative Bitcoin implementations with forkable governance.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How is this different from Bitcoin Core?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Core is a single implementation with informal governance. Bitcoin Commons provides: (1) BLLVM - Mathematical rigor enabling safe alternatives, (2) Commons - Forkable governance enabling coordination. Bitcoin Core has excellent consensus security; Bitcoin Commons adds governance security and implementation diversity.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Is this a fork of Bitcoin?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>No. Neither BLLVM nor Bitcoin Commons forks Bitcoin's blockchain or consensus rules. BLLVM provides mathematical specification enabling safe alternative implementations. Bitcoin Commons provides governance framework enabling coordination. Both maintain full Bitcoin consensus compatibility.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Is the system production ready?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>The system is in Phase 1 (Infrastructure Complete). All core components of both BLLVM and Bitcoin Commons are implemented, but governance is not yet activated. Phase 2 (Governance Activation) will proceed when a suitable cohort of keyholders has been found. The system is not yet battle-tested in production.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How do BLLVM and Bitcoin Commons work together?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>BLLVM provides the mathematical foundation and compiler-like architecture (Orange Paper as IR, formal verification passes). Bitcoin Commons provides the governance framework (coordination without civil war). The modular architecture is where both meet: BLLVM ensures correctness through architectural enforcement; Commons ensures coordination through governance rules. You can't have safe alternative implementations without BLLVM's mathematical rigor, and you can't have coordination without Commons' governance framework.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 1: Overview - Two Innovations -->
                    <div class="faq-category">
                        <h3>Overview: Two Innovations</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What are the two innovations?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p><strong>BLLVM (Bitcoin Low-Level Virtual Machine)</strong>: Technical innovation providing mathematical rigor through the Orange Paper (mathematical specification), formal verification (Kani proofs), proofs locked to code, and a compiler-like architecture. This ensures correctness.</p>
                                    <p><strong>Bitcoin Commons (Cryptographic Commons)</strong>: Governance innovation providing forkable governance through Ostrom's principles, cryptographic enforcement, 5-tier governance model, and transparent audit trails. This ensures coordination.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What's the relationship between Bitcoin Commons and BTCDecoded?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Commons is the governance framework; BTCDecoded is the first complete implementation of both innovations (BLLVM + Commons). Think of BLLVM as the technical foundation, Bitcoin Commons as the governance constitution, and BTCDecoded as the first "government" built on both. Other implementations can adopt the same framework.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 2: BLLVM - Technical Innovation -->
                    <div class="faq-category">
                        <h3>BLLVM: Technical Innovation</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What is BLLVM?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>BLLVM (Bitcoin Low-Level Virtual Machine) is the technical stack that provides mathematical rigor for Bitcoin implementations. It includes: (1) Orange Paper - complete mathematical specification of Bitcoin consensus, (2) bllvm-consensus - pure mathematical implementation with formal verification, (3) bllvm-protocol - Bitcoin abstraction layer, (4) bllvm-node - full node implementation, (5) bllvm-sdk - developer toolkit. Think of it as a compiler-like architecture where the Orange Paper is the IR (intermediate representation).</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What is the Orange Paper?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>The Orange Paper is a complete mathematical specification of Bitcoin's consensus protocol, extracted from Bitcoin Core using AI-assisted analysis. It serves as the "intermediate representation" (IR) in BLLVM's compiler-like architecture. It enables safe alternative implementations by providing formal, verifiable consensus rules that can be mathematically proven correct.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does formal verification work in BLLVM?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>BLLVM uses Kani model checking to formally verify consensus-critical code. The Orange Paper provides the mathematical specification; bllvm-consensus implements it with proofs locked to code. All consensus decisions flow through verified functions, and the dependency chain prevents bypassing verification. This provides mathematical proof of correctness, not just testing.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How is BLLVM different from Bitcoin Core?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Core embeds consensus rules in 350,000+ lines of C++ with no mathematical specification. BLLVM provides: (1) Mathematical specification (Orange Paper), (2) Formal verification (Kani proofs), (3) Proofs locked to code, (4) Compiler-like architecture enabling safe alternative implementations. BLLVM doesn't replace Bitcoin Core; it enables safe alternatives.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What does "compiler-like architecture" mean?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Like a compiler has source code ‚Üí IR ‚Üí machine code, BLLVM has: Bitcoin Core code ‚Üí Orange Paper (IR) ‚Üí bllvm-consensus ‚Üí bllvm-node. The Orange Paper serves as the intermediate representation that multiple implementations can target, just like multiple compilers can target the same IR. This enables implementation diversity while maintaining consensus correctness.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 3: Bitcoin Commons - Governance Innovation -->
                    <div class="faq-category">
                        <h3>Bitcoin Commons: Governance Innovation</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What is Bitcoin Commons (the governance framework)?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Commons is a forkable governance framework that applies Elinor Ostrom's proven commons management principles through cryptographic enforcement. It solves Bitcoin's governance asymmetry by making development governance as robust as technical consensus. It provides coordination without civil war through forkable rules, cryptographic signatures, and transparent audit trails.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does Bitcoin Commons governance work?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Commons uses a 5-tier constitutional governance model with graduated signature thresholds (3-of-5 for routine maintenance, up to 6-of-7 for consensus changes) and review periods (7 days to 365 days). The system combines <strong>Layers</strong> (which repository) and <strong>Tiers</strong> (what type of change), using "most restrictive wins" for maximum security. All governance actions are cryptographically signed and transparently auditable. <strong>Economic nodes</strong> (mining pools, exchanges, custodians) can veto consensus-adjacent changes. Users can <strong>fork governance rulesets</strong> if they disagree, creating exit competition. A <strong>three-tiered emergency system</strong> provides proportional response to critical issues.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What makes Bitcoin Commons governance "6x harder to capture"?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Multiple mechanisms: (1) Forkable governance rules allow users to exit if governance is captured, (2) Multiple implementations compete, preventing monopoly, (3) Cryptographic enforcement makes power visible and accountable, (4) Economic alignment through merge mining, (5) Graduated thresholds prevent rapid changes, (6) Transparent audit trails.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does forkable governance work?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Users can fork the governance rules (not just the code) if they disagree with decisions. This creates exit competition: if governance is captured, users can fork to a better governance model while maintaining Bitcoin consensus compatibility. The threat of forking prevents capture.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What are Ostrom's principles?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Elinor Ostrom's Nobel Prize-winning research identified 8 principles for managing commons successfully. Bitcoin Commons applies these through: clearly defined boundaries, proportional equivalence, collective choice, monitoring, graduated sanctions, conflict resolution, minimal recognition of rights, and nested enterprises.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 4: How They Work Together -->
                    <div class="faq-category">
                        <h3>How They Work Together</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Why do you need both BLLVM and Bitcoin Commons?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>BLLVM solves the technical problem (mathematical rigor, safe alternative implementations). Bitcoin Commons solves the governance problem (coordination without civil war). You can't have safe alternatives without BLLVM's mathematical foundation, and you can't have coordination without Commons' governance framework. They enable each other.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does the modular architecture combine both innovations?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>The modular architecture has three layers: (1) Mandatory Consensus (BLLVM ensures correctness), (2) Optional Modules (Commons enables competition), (3) Economic Coordination (merge mining funds both). BLLVM ensures correctness through architectural enforcement; Commons ensures coordination through governance rules. The architecture is where both meet.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Can you use BLLVM without Bitcoin Commons governance?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Technically yes: BLLVM is a technical stack that can be used independently. However, without Bitcoin Commons governance, you'd still have the governance capture problem. The innovations are designed to work together: BLLVM enables safe alternatives, Commons enables coordination between alternatives.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Can you use Bitcoin Commons governance without BLLVM?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>The governance framework could theoretically be applied to other implementations, but BLLVM's mathematical rigor (Orange Paper, formal verification) is what makes alternative implementations safe. Without BLLVM, you'd have governance but still risk consensus bugs from informal implementations.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 5: Technical Details - BLLVM -->
                    <div class="faq-category">
                        <h3>Technical Details: BLLVM</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What is formal verification in BLLVM?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>BLLVM uses Kani model checking to mathematically prove code correctness. The Orange Paper provides the specification; bllvm-consensus implements it with proofs. All consensus decisions flow through verified functions. This provides mathematical proof, not just testing.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How many formal proofs does BLLVM have?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>BLLVM has nearly 200 formal proofs in the source code, providing comprehensive formal verification coverage of consensus-critical functions. The proofs are embedded directly in the codebase and verified continuously.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What does "proofs locked to code" mean?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Formal verification proofs are embedded in the code itself, not separate documentation. The proofs verify that the code matches the Orange Paper specification. If code changes, proofs must be updated, ensuring correctness is maintained.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does BLLVM prevent consensus bugs?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Through multiple layers: (1) Orange Paper provides mathematical specification, (2) Formal verification proves implementation matches spec, (3) Proofs locked to code prevent drift, (4) Dependency chain forces all consensus through verified functions, (5) Spec drift detection alerts if code diverges from spec.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 6: Governance Details - Bitcoin Commons -->
                    <div class="faq-category">
                        <h3>Governance Details: Bitcoin Commons</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does cryptographic enforcement work?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>All governance actions require cryptographic signatures from maintainers. The bllvm-commons (GitHub App) verifies signatures, enforces thresholds (e.g., 6-of-7), and blocks merges until requirements are met. This makes power visible and accountable: you can see who signed what, when.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What happens if governance is captured?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Forkable governance means users can fork to a better governance model. This creates exit competition: captured governance loses users to better-governed implementations. The threat of forking prevents capture. Unlike Bitcoin Core, you can fork the governance rules, not just the code.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does economic alignment work?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Through merge mining revenue. Secondary chains merge-mine with Bitcoin, providing revenue that flows to development priorities through governance decisions. Miners have economic incentives to support well-governed implementations because they benefit from network health.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What is merge mining?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Merge mining allows miners to mine multiple blockchains simultaneously using the same proof-of-work. Bitcoin Commons implementations can merge-mine with Bitcoin, providing economic sustainability without changing Bitcoin's consensus. 1% of merged chain rewards fund development.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What are economic nodes?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Economic nodes represent Bitcoin's economic stakeholders (mining pools, exchanges, custodians) and provide veto power over consensus-adjacent changes. They ensure governance decisions align with economic incentives. For Tier 3+ changes, economic nodes can veto if 30%+ hashpower or 40%+ economic activity signals opposition. This protects users by ensuring major changes consider economic impact.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does governance forking work?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Governance forks allow users to choose different governance rulesets without affecting Bitcoin consensus. Users can export governance rulesets as versioned, signed packages and fork to a better governance model if they disagree with decisions. This provides an escape hatch: captured governance loses users to better-governed implementations. The threat of forking prevents capture while maintaining Bitcoin consensus immutability.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How do layers and tiers combine in governance?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Commons uses a dual-dimensional system: <strong>Layers</strong> (which repository) and <strong>Tiers</strong> (what type of change). When both apply, the system uses "most restrictive wins" - taking the highest signature threshold and longest review period. For example, a bug fix in the Protocol Engine (Layer 3) requires 4-of-5 signatures and 90 days, even though Tier 1 (routine maintenance) normally requires only 3-of-5 and 7 days. This ensures maximum security for sensitive repositories.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does the emergency tier system work?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin Commons uses a three-tiered emergency response system for proportional handling of critical issues: <strong>Tier 1: Critical Emergency</strong> (network-threatening, 0 days, 4-of-7 maintainers, 7 day max), <strong>Tier 2: Urgent Security</strong> (security issues, 7 days, 5-of-7 maintainers, 30 day max), <strong>Tier 3: Elevated Priority</strong> (important but not critical, 30 days, 6-of-7 maintainers, 90 day max). This ensures rapid response to critical threats while maintaining appropriate review for less urgent issues.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 7: Implementation Status -->
                    <div class="faq-category">
                        <h3>Implementation Status</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What's the current status of BLLVM?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Orange Paper complete, bllvm-consensus with nearly 200 formal proofs, bllvm-protocol, bllvm-node, and bllvm-sdk all implemented. All 6 tiers are functional, but not yet battle-tested in production.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What's the current status of Bitcoin Commons governance?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>All core governance infrastructure is implemented: bllvm-commons (GitHub integration, signature verification, status checks), economic node system (veto power for consensus-adjacent changes), governance fork capability (ruleset export and forking), emergency tier system (three-tiered response), and layer+tier combination model. However, governance is not yet activated (test keys only) and keyholders are not yet onboarded. Phase 2 activation will proceed when a suitable cohort of keyholders has been found.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>When will governance be activated?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Phase 2 activation will proceed when a suitable cohort of keyholders has been found. This requires: (1) Security audits, (2) Keyholder onboarding, (3) Governance app deployment, (4) Community testing. Phase 3 (full operation) will follow after Phase 2 is stable.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 8: Getting Involved -->
                    <div class="faq-category">
                        <h3>Getting Involved</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How can I contribute?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Review BLLVM code and formal proofs, review Bitcoin Commons governance rules, submit issues and pull requests, help with testing and security audits, build your own implementation using both innovations, or participate in governance discussions.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Can I build my own implementation?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Yes! You can use BLLVM's technical stack (Orange Paper, bllvm-consensus) and adopt Bitcoin Commons governance framework. Fork the governance model, customize it for your organization, and build your own Bitcoin-compatible implementation. See the <a href="https://github.com/BTCDecoded/governance/blob/main/IMPLEMENTATIONS_REGISTRY.md" target="_blank" rel="noopener">Implementations Registry</a>.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Where is the code?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>All code is open source on GitHub under the <a href="https://github.com/BTCDecoded" target="_blank" rel="noopener">BTCDecoded organization</a>. Key repositories: BLLVM (bllvm-spec/Orange Paper, bllvm-consensus, bllvm-protocol, bllvm-node, bllvm-sdk) and Commons (governance, bllvm-commons).</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>What documentation should I read?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p><a href="whitepaper.html">White Paper</a> for complete technical and governance overview, <a href="https://docs.thebitcoincommons.org" target="_blank" rel="noopener">Documentation</a> for unified technical documentation, and <a href="https://github.com/BTCDecoded/governance" target="_blank" rel="noopener">Governance Docs</a> for governance rules and processes.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category 9: Philosophy & Comparison -->
                    <div class="faq-category">
                        <h3>Philosophy & Comparison</h3>
                        <div class="faq-accordion">
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>Why "commons"?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Bitcoin's codebase is a commons: a shared resource that benefits everyone but no one owns. Traditional commons fail due to tragedy of the commons. Ostrom showed how to manage commons successfully. Bitcoin Commons applies these proven principles through cryptographic enforcement.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <button class="faq-question" aria-expanded="false">
                                    <span>How does this relate to cypherpunk philosophy?</span>
                                    <span class="faq-icon">+</span>
                                </button>
                                <div class="faq-answer">
                                    <p>Cypherpunks focused on eliminating trusted third parties in transactions. Bitcoin Commons extends this to development: eliminate trusted parties in governance through cryptographic enforcement, transparency, and forkability. BLLVM extends this to implementation: eliminate trusted implementations through mathematical proof.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="book" class="book-section" style="display: none;">
            <div class="container">
                <h2>The Book</h2>
                <div class="book-content">
                    <div class="book-info">
                        <h3>Bitcoin Commons: Decentralizing the Decentralizers</h3>
                        <p class="book-tagline">Bitcoin solved trust in transactions. Now we must solve trust in development.</p>
                        
                        <div class="book-toc">
                            <h4>Table of Contents</h4>
                            <ul>
                                <li><strong>Part I: Recovery and Discovery</strong> - The governance crisis Gavin Andresen predicted</li>
                                <li><strong>Part II: The Framework</strong> - Ostrom's commons principles and the cypherpunk blind spot</li>
                                <li><strong>Part III: The Solution Built</strong> - Orange Paper, 6-tier stack, governance system</li>
                                <li><strong>Part IV: The Path Forward</strong> - How to build uncapturable governance institutions</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="book-purchase">
                        <div class="book-cover">
                            <h3>Bitcoin Commons</h3>
                            <p>Decentralizing the Decentralizers</p>
                        </div>
                        
                        <div class="price">$10</div>
                        
                        <div class="purchase-buttons">
                            <a href="#" class="btn btn-primary btn-large" onclick="alert('Amazon Kindle version coming soon!')">Buy on Amazon Kindle</a>
                            <button id="bitcoin-pay" class="btn btn-secondary btn-large">Pay with Bitcoin</button>
                        </div>
                        
                        <p class="coming-soon">Amazon Kindle version coming soon</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="https://btcdecoded.org" target="_blank" rel="noopener">BTCDecoded.org</a>
                <a href="https://docs.thebitcoincommons.org" target="_blank" rel="noopener">Documentation</a>
                <a href="whitepaper.html">White Paper</a>
                <a href="#fork-governance">Fork Governance</a>
                <a href="#faq">FAQ</a>
            </div>
            
            <div class="social-links">
                <a href="https://github.com/BTCDecoded" target="_blank" rel="noopener" aria-label="GitHub">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </a>
                <a href="https://x.com/BtcCommons" target="_blank" rel="noopener" aria-label="X (Twitter)">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
            </div>
            
            <p class="footer-text">Multiple implementations can coexist using this framework.</p>
            <p class="copyright">&copy; 2025 BTCDecoded</p>
        </div>
    </footer>

    <!-- Bitcoin Payment Modal -->
    <div id="payment-modal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div class="modal-content" style="background-color: var(--bg-primary); margin: 15% auto; padding: 2rem; border-radius: 8px; max-width: 500px; position: relative;">
            <span class="close" style="color: var(--text-secondary); float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <h3>Pay with Bitcoin</h3>
            <div id="invoice-content">
                <p>Creating invoice...</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // FAQ Accordion functionality
            const faqQuestions = document.querySelectorAll('.faq-question');
            
            faqQuestions.forEach(question => {
                question.addEventListener('click', function() {
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    const answer = this.nextElementSibling;
                    
                    // Close all other FAQ items in the same category
                    const category = this.closest('.faq-category');
                    const allQuestionsInCategory = category.querySelectorAll('.faq-question');
                    const allAnswersInCategory = category.querySelectorAll('.faq-answer');
                    
                    allQuestionsInCategory.forEach(q => {
                        if (q !== this) {
                            q.setAttribute('aria-expanded', 'false');
                        }
                    });
                    
                    allAnswersInCategory.forEach(a => {
                        if (a !== answer) {
                            a.style.height = '0';
                            a.style.padding = '0 2rem';
                            const q = a.previousElementSibling;
                            if (q) q.setAttribute('aria-expanded', 'false');
                        }
                    });
                    
                    // Toggle current item
                    if (isExpanded) {
                        this.setAttribute('aria-expanded', 'false');
                        answer.style.height = '0';
                        answer.style.padding = '0 2rem';
                    } else {
                        this.setAttribute('aria-expanded', 'true');
                        // Save current styles
                        const currentTransition = answer.style.transition;
                        // Set padding first and wait for it to apply
                        answer.style.padding = '1.5rem 2rem 2rem 2rem';
                        // Remove transition temporarily
                        answer.style.transition = 'none';
                        // Use requestAnimationFrame to ensure padding is applied before measuring
                        requestAnimationFrame(() => {
                            // Temporarily remove all height constraints to measure accurately
                            answer.style.height = 'auto';
                            answer.style.maxHeight = 'none';
                            answer.style.minHeight = '0';
                            // Force browser reflow
                            void answer.offsetHeight;
                            // Get the actual content height
                            // scrollHeight is the total height including padding
                            const measuredHeight = answer.scrollHeight;
                            // Reset to collapsed state
                            answer.style.height = '0';
                            answer.style.maxHeight = '';
                            answer.style.minHeight = '';
                            // Restore transition
                            answer.style.transition = currentTransition || '';
                            // Force another reflow
                            void answer.offsetHeight;
                            // Animate to full height
                            requestAnimationFrame(() => {
                                answer.style.height = measuredHeight + 'px';
                            });
                        });
                    }
                });
                
                // Keyboard accessibility
                question.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
            
            // Smooth scroll to FAQ section when linked
            const faqLink = document.querySelector('a[href="#faq"]');
            if (faqLink) {
                faqLink.addEventListener('click', function(e) {
                    const faqSection = document.getElementById('faq');
                    if (faqSection) {
                        e.preventDefault();
                        faqSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            }
            
            // Simple Bitcoin payment handler (same as BTCDecoded site)
            const bitcoinPayBtn = document.getElementById('bitcoin-pay');
            const modal = document.getElementById('payment-modal');
            const modalContent = document.getElementById('invoice-content');
            const closeBtn = document.querySelector('.close');
            
            if (bitcoinPayBtn) {
                bitcoinPayBtn.addEventListener('click', function() {
                    modal.style.display = 'block';
                    modalContent.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <p>Bitcoin payment integration coming soon.</p>
                            <p style="margin-top: 1rem; color: var(--text-secondary);">For now, please use the Amazon Kindle option.</p>
                        </div>
                    `;
                });
            }
            
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }
            
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }
            
            // Fork Governance Tool
            function updateRulesetPreview() {
                const ruleset = {
                    version: "1.0",
                    ruleset_id: document.getElementById('ruleset-name').value || 'custom-governance-v1',
                    ruleset_version: document.getElementById('ruleset-version').value || '1.0.0',
                    created_at: new Date().toISOString(),
                    description: document.getElementById('ruleset-description').value || '',
                    action_tiers: {
                        tier_1_routine: {
                            name: "Routine Maintenance",
                            signature_threshold: document.getElementById('tier1-signatures').value,
                            review_period_days: parseInt(document.getElementById('tier1-review').value)
                        },
                        tier_2_features: {
                            name: "Feature Changes",
                            signature_threshold: document.getElementById('tier2-signatures').value,
                            review_period_days: parseInt(document.getElementById('tier2-review').value)
                        },
                        tier_3_consensus_adjacent: {
                            name: "Consensus-Adjacent",
                            signature_threshold: document.getElementById('tier3-signatures').value,
                            review_period_days: parseInt(document.getElementById('tier3-review').value),
                            economic_node_veto: {
                                mining_threshold: parseFloat(document.getElementById('tier3-veto').value)
                            }
                        }
                    },
                    metadata: {
                        exported_by: "thebitcoincommons.org",
                        source_repository: "BTCDecoded/governance",
                        export_tool_version: "1.0.0"
                    }
                };
                
                document.getElementById('ruleset-preview').textContent = JSON.stringify(ruleset, null, 2);
                return ruleset;
            }
            
            // Update preview on any change
            const forkInputs = document.querySelectorAll('#fork-governance input, #fork-governance select, #fork-governance textarea');
            forkInputs.forEach(input => {
                input.addEventListener('input', function() {
                    try {
                        updateRulesetPreview();
                    } catch (e) {
                        console.error('Error updating preview:', e);
                        document.getElementById('ruleset-preview').textContent = 'Error: Could not update preview. Please check your inputs.';
                    }
                });
                input.addEventListener('change', function() {
                    try {
                        updateRulesetPreview();
                    } catch (e) {
                        console.error('Error updating preview:', e);
                        document.getElementById('ruleset-preview').textContent = 'Error: Could not update preview. Please check your inputs.';
                    }
                });
            });
            
            // Handle repository selection radio buttons
            document.querySelectorAll('input[name="fork-repo"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    // Update checked class for styling (fallback for browsers without :has())
                    document.querySelectorAll('.repo-checkbox-label').forEach(label => {
                        label.classList.remove('checked');
                    });
                    if (this.checked) {
                        this.closest('.repo-checkbox-label').classList.add('checked');
                    }
                    updateRulesetPreview();
                });
            });
            
            // Initialize checked state on page load
            document.addEventListener('DOMContentLoaded', function() {
                document.querySelectorAll('input[name="fork-repo"]:checked').forEach(radio => {
                    radio.closest('.repo-checkbox-label')?.classList.add('checked');
                });
            });
            
            // Initial preview - wait for DOM to be ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(updateRulesetPreview, 100);
                });
            } else {
                setTimeout(updateRulesetPreview, 100);
            }
            
            // Export functions
            document.getElementById('export-yaml').addEventListener('click', function() {
                const ruleset = updateRulesetPreview();
                // Simple YAML conversion (basic implementation)
                let yaml = `# Governance Ruleset Export\n`;
                yaml += `# Generated by thebitcoincommons.org\n`;
                yaml += `# ${new Date().toISOString()}\n\n`;
                yaml += `version: "${ruleset.version}"\n`;
                yaml += `ruleset_id: "${ruleset.ruleset_id}"\n`;
                yaml += `ruleset_version: "${ruleset.ruleset_version}"\n`;
                yaml += `created_at: "${ruleset.created_at}"\n`;
                if (ruleset.description) {
                    yaml += `description: "${ruleset.description}"\n`;
                }
                yaml += `\naction_tiers:\n`;
                yaml += `  tier_1_routine:\n`;
                yaml += `    name: "${ruleset.action_tiers.tier_1_routine.name}"\n`;
                yaml += `    signature_threshold: "${ruleset.action_tiers.tier_1_routine.signature_threshold}"\n`;
                yaml += `    review_period_days: ${ruleset.action_tiers.tier_1_routine.review_period_days}\n`;
                yaml += `  tier_2_features:\n`;
                yaml += `    name: "${ruleset.action_tiers.tier_2_features.name}"\n`;
                yaml += `    signature_threshold: "${ruleset.action_tiers.tier_2_features.signature_threshold}"\n`;
                yaml += `    review_period_days: ${ruleset.action_tiers.tier_2_features.review_period_days}\n`;
                yaml += `  tier_3_consensus_adjacent:\n`;
                yaml += `    name: "${ruleset.action_tiers.tier_3_consensus_adjacent.name}"\n`;
                yaml += `    signature_threshold: "${ruleset.action_tiers.tier_3_consensus_adjacent.signature_threshold}"\n`;
                yaml += `    review_period_days: ${ruleset.action_tiers.tier_3_consensus_adjacent.review_period_days}\n`;
                yaml += `    economic_node_veto:\n`;
                yaml += `      mining_threshold: ${ruleset.action_tiers.tier_3_consensus_adjacent.economic_node_veto.mining_threshold}\n`;
                
                const blob = new Blob([yaml], { type: 'text/yaml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${ruleset.ruleset_id}-${ruleset.ruleset_version}.yml`;
                a.click();
                URL.revokeObjectURL(url);
            });
            
            document.getElementById('export-json').addEventListener('click', function() {
                const ruleset = updateRulesetPreview();
                const json = JSON.stringify(ruleset, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${ruleset.ruleset_id}-${ruleset.ruleset_version}.json`;
                a.click();
                URL.revokeObjectURL(url);
            });
            
            document.getElementById('download-ruleset').addEventListener('click', function() {
                document.getElementById('export-json').click();
            });
            
            // Fork Templates Data
            const forkTemplates = {
                conservative: {
                    name: "Conservative",
                    tier1: { signatures: "4-of-5", review: 14 },
                    tier2: { signatures: "5-of-5", review: 60 },
                    tier3: { signatures: "6-of-7", review: 180, veto: 25 }
                },
                balanced: {
                    name: "Balanced (Default)",
                    tier1: { signatures: "3-of-5", review: 7 },
                    tier2: { signatures: "4-of-5", review: 30 },
                    tier3: { signatures: "5-of-5", review: 90, veto: 30 }
                },
                agile: {
                    name: "Agile",
                    tier1: { signatures: "2-of-3", review: 3 },
                    tier2: { signatures: "3-of-5", review: 14 },
                    tier3: { signatures: "4-of-5", review: 60, veto: 35 }
                },
                community: {
                    name: "Community-Driven",
                    tier1: { signatures: "3-of-5", review: 7 },
                    tier2: { signatures: "4-of-5", review: 30 },
                    tier3: { signatures: "5-of-5", review: 90, veto: 20 }
                },
                default: {
                    name: "BTCDecoded",
                    tier1: { signatures: "3-of-5", review: 7 },
                    tier2: { signatures: "4-of-5", review: 30 },
                    tier3: { signatures: "5-of-5", review: 90, veto: 30 }
                }
            };
            
            // Tab Switching
            document.querySelectorAll('.fork-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Update tab buttons
                    document.querySelectorAll('.fork-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update tab content
                    document.querySelectorAll('.fork-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(targetTab + '-tab').classList.add('active');
                });
            });
            
            // Template Fork Buttons - Switch to Custom Tab and Load Template
            document.querySelectorAll('.template-fork-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const template = this.closest('.template-card').getAttribute('data-template');
                    // Switch to custom tab
                    document.querySelectorAll('.fork-tab').forEach(t => t.classList.remove('active'));
                    document.querySelector('.fork-tab[data-tab="custom"]').classList.add('active');
                    document.querySelectorAll('.fork-tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById('custom-tab').classList.add('active');
                    
                    // Load template values into form
                    loadTemplate(template);
                    updateRulesetPreview();
                });
            });
            
            // Deployment Instructions Modal
            function showDeploymentModal(forkType) {
                const template = forkTemplates[forkType] || forkTemplates.balanced;
                const rulesetName = forkType + '-governance-v1';
                
                const modal = document.createElement('div');
                modal.className = 'deployment-modal';
                modal.style.cssText = 'position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;';
                
                modal.innerHTML = `
                    <div class="deployment-modal-content" style="background-color: var(--bg-primary); margin: 2rem; padding: 2rem; border-radius: 8px; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative;">
                        <button class="deployment-modal-close" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">&times;</button>
                        <h3 style="margin-top: 0;">‚úÖ Fork Created: ${template.name}</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Your ruleset file has been downloaded. Here's how to deploy it:</p>
                        
                        <div class="deployment-steps">
                            <div class="deployment-step">
                                <h4>1. Copy your ruleset file</h4>
                                <p>The file <code>${rulesetName}-1.0.0.json</code> has been downloaded to your computer.</p>
                            </div>
                            
                            <div class="deployment-step">
                                <h4>2. Move it to your node directory</h4>
                                <div class="code-block">
                                    <code>mv ${rulesetName}-1.0.0.json ~/.bllvm-node/governance-rulesets/</code>
                                    <button class="copy-btn" data-copy="mv ${rulesetName}-1.0.0.json ~/.bllvm-node/governance-rulesets/">Copy</button>
                                </div>
                            </div>
                            
                            <div class="deployment-step">
                                <h4>3. Start your node with the ruleset</h4>
                                <div class="code-block">
                                    <code>bllvm-node --governance-ruleset=${rulesetName}</code>
                                    <button class="copy-btn" data-copy="bllvm-node --governance-ruleset=${rulesetName}">Copy</button>
                                </div>
                            </div>
                            
                            <div class="deployment-step">
                                <h4>4. Verify it's working</h4>
                                <div class="code-block">
                                    <code>bllvm-node --governance-status</code>
                                    <button class="copy-btn" data-copy="bllvm-node --governance-status">Copy</button>
                                </div>
                                <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">You should see your ruleset name and version.</p>
                            </div>
                        </div>
                        
                        <div class="deployment-note" style="margin-top: 1.5rem; padding: 1rem; background-color: var(--bg-secondary); border-radius: 6px; border-left: 3px solid var(--bitcoin-orange);">
                            <p style="margin: 0;"><strong>üí° Remember:</strong> Governance forks don't affect Bitcoin consensus. Your node validates the same blockchain as everyone else, but uses your governance rules for development decisions.</p>
                        </div>
                        
                        <div class="deployment-actions" style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="this.closest('.deployment-modal').remove()">Got it!</button>
                            <a href="https://github.com/BTCDecoded/governance/blob/main/architecture/GOVERNANCE_FORK.md" target="_blank" class="btn btn-outline">Read Full Guide</a>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Close button
                modal.querySelector('.deployment-modal-close').addEventListener('click', () => modal.remove());
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });
                
                // Copy buttons
                modal.querySelectorAll('.copy-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const code = this.getAttribute('data-copy');
                        navigator.clipboard.writeText(code).then(() => {
                            const originalText = this.textContent;
                            this.textContent = 'Copied!';
                            setTimeout(() => {
                                this.textContent = originalText;
                            }, 2000);
                        });
                    });
                });
            }
            
            // Load Template Function
            function loadTemplate(templateName) {
                const template = forkTemplates[templateName];
                if (!template) return;
                
                // Set form values with proper event dispatching
                const tier1Select = document.getElementById('tier1-signatures');
                tier1Select.value = template.tier1.signatures;
                tier1Select.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier1Review = document.getElementById('tier1-review');
                tier1Review.value = template.tier1.review;
                tier1Review.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier2Select = document.getElementById('tier2-signatures');
                tier2Select.value = template.tier2.signatures;
                tier2Select.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier2Review = document.getElementById('tier2-review');
                tier2Review.value = template.tier2.review;
                tier2Review.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier3Select = document.getElementById('tier3-signatures');
                tier3Select.value = template.tier3.signatures;
                tier3Select.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier3Review = document.getElementById('tier3-review');
                tier3Review.value = template.tier3.review;
                tier3Review.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier3Veto = document.getElementById('tier3-veto');
                tier3Veto.value = template.tier3.veto;
                tier3Veto.dispatchEvent(new Event('change', { bubbles: true }));
                
                // Set metadata
                document.getElementById('ruleset-name').value = templateName + '-governance-v1';
                document.getElementById('ruleset-version').value = '1.0.0';
                document.getElementById('ruleset-description').value = `Custom governance ruleset based on ${template.name} template.`;
                
                // Update preview
                updateRulesetPreview();
            }
            
            // Comparison Function (updated to use registry)
            function updateComparison() {
                if (forkRegistry && forkRegistry.length > 0) {
                    updateComparisonFromRegistry(forkRegistry);
                } else {
                    // Fallback to templates
                    const fork1 = document.getElementById('compare-fork1').value;
                    const fork2 = document.getElementById('compare-fork2').value;
                    
                    if (fork1 === fork2) {
                        document.getElementById('compare-results').innerHTML = '<p class="compare-error">Please select two different forks to compare.</p>';
                        return;
                    }
                    
                    const t1 = forkTemplates[fork1];
                    const t2 = forkTemplates[fork2];
                    
                    if (!t1 || !t2) return;
                    
                    const comparison = `
                        <table class="compare-table-content">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>${t1.name}</th>
                                    <th>${t2.name}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Tier 1: Signature Threshold</strong></td>
                                    <td>${t1.tier1.signatures}</td>
                                    <td>${t2.tier1.signatures}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 1: Review Period</strong></td>
                                    <td>${t1.tier1.review} days</td>
                                    <td>${t2.tier1.review} days</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 2: Signature Threshold</strong></td>
                                    <td>${t1.tier2.signatures}</td>
                                    <td>${t2.tier2.signatures}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 2: Review Period</strong></td>
                                    <td>${t1.tier2.review} days</td>
                                    <td>${t2.tier2.review} days</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 3: Signature Threshold</strong></td>
                                    <td>${t1.tier3.signatures}</td>
                                    <td>${t2.tier3.signatures}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tier 3: Review Period</strong></td>
                                    <td>${t1.tier3.review} days</td>
                                    <td>${t2.tier3.review} days</td>
                                </tr>
                                <tr>
                                    <td><strong>Economic Node Veto Threshold</strong></td>
                                    <td>${t1.tier3.veto}%</td>
                                    <td>${t2.tier3.veto}%</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                    
                    document.getElementById('compare-results').innerHTML = comparison;
                }
            }
            
            // Comparison selectors
            document.getElementById('compare-fork1').addEventListener('change', updateComparison);
            document.getElementById('compare-fork2').addEventListener('change', updateComparison);
            
            // Load registry on page load for marketplace and compare
            let registryLoaded = false;
            async function initializeRegistry() {
                if (registryLoaded) return;
                try {
                    const forks = await loadForkRegistry();
                    forkRegistry = forks;
                    renderMarketplaceCards(forks);
                    populateCompareDropdowns(forks);
                    registryLoaded = true;
                } catch (error) {
                    console.error('Failed to initialize registry:', error);
                }
            }
            
            // Fork Registry - Load from GitHub
            // Use commit SHA URL first since it's more reliable (bypasses CDN cache)
            const FORK_REGISTRY_URL = 'https://raw.githubusercontent.com/BTCDecoded/governance/268f9c4/fork-registry.yml';
            const FORK_REGISTRY_URL_MAIN = 'https://raw.githubusercontent.com/BTCDecoded/governance/main/fork-registry.yml';
            let forkRegistry = null;
            
            // Initialize on page load
            initializeRegistry();
            
            // YAML parser (simple implementation for basic YAML)
            function parseYAML(yamlText) {
                // Simple YAML parser for our specific format
                const forks = [];
                const lines = yamlText.split('\n');
                let currentFork = null;
                let inForks = false;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line === 'forks:') {
                        inForks = true;
                        continue;
                    }
                    if (!inForks) continue;
                    if (line.startsWith('- id:')) {
                        if (currentFork) forks.push(currentFork);
                        currentFork = { id: line.split(':')[1].trim() };
                    } else if (line.startsWith('name:')) {
                        if (currentFork) currentFork.name = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    } else if (line.startsWith('description:')) {
                        if (currentFork) currentFork.description = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    } else if (line.startsWith('forked_from:')) {
                        if (currentFork) {
                            const value = line.split(':').slice(1).join(':').trim();
                            currentFork.forked_from = value === 'null' ? null : value.replace(/^["']|["']$/g, '');
                        }
                    } else if (line.startsWith('created_by:')) {
                        if (currentFork) currentFork.created_by = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    } else if (line.startsWith('github:')) {
                        if (currentFork) currentFork.github = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    } else if (line.startsWith('tier1:')) {
                        if (currentFork) currentFork.tier1 = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    } else if (line.startsWith('tier1_review:')) {
                        if (currentFork) currentFork.tier1_review = parseInt(line.split(':')[1].trim());
                    } else if (line.startsWith('tier2:')) {
                        if (currentFork) currentFork.tier2 = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    } else if (line.startsWith('tier2_review:')) {
                        if (currentFork) currentFork.tier2_review = parseInt(line.split(':')[1].trim());
                    } else if (line.startsWith('tier3:')) {
                        if (currentFork) currentFork.tier3 = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    } else if (line.startsWith('tier3_review:')) {
                        if (currentFork) currentFork.tier3_review = parseInt(line.split(':')[1].trim());
                    } else if (line.startsWith('tier3_veto:')) {
                        if (currentFork) currentFork.tier3_veto = parseInt(line.split(':')[1].trim());
                    } else if (line.startsWith('verified:')) {
                        if (currentFork) currentFork.verified = line.split(':')[1].trim() === 'true';
                    } else if (line.startsWith('created_at:')) {
                        if (currentFork) currentFork.created_at = line.split(':').slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                    }
                }
                if (currentFork) forks.push(currentFork);
                return forks;
            }
            
            // Load fork registry with error handling and fallback
            async function loadForkRegistry() {
                // Try multiple URLs in case of caching issues
                // Start with commit SHA (most reliable, bypasses CDN cache)
                const urls = [
                    FORK_REGISTRY_URL, // Commit SHA URL (primary)
                    FORK_REGISTRY_URL_MAIN, // Main branch URL (fallback)
                    'https://api.github.com/repos/BTCDecoded/governance/contents/fork-registry.yml?ref=main' // API endpoint (last resort)
                ];
                
                for (let urlIndex = 0; urlIndex < urls.length; urlIndex++) {
                    const url = urls[urlIndex];
                    try {
                        // Add timeout for fetch
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                        
                        const response = await fetch(url, {
                            signal: controller.signal,
                            headers: {
                                'Accept': url.includes('api.github.com') 
                                    ? 'application/vnd.github.v3+json' 
                                    : 'text/yaml, text/plain, */*'
                            }
                        });
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) {
                            if (urlIndex < urls.length - 1) continue; // Try next URL
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        let yamlText;
                        if (url.includes('api.github.com')) {
                            // GitHub API returns base64 encoded content
                            const data = await response.json();
                            yamlText = atob(data.content.replace(/\n/g, ''));
                        } else {
                            yamlText = await response.text();
                        }
                        
                        if (!yamlText || yamlText.trim().length === 0) {
                            if (urlIndex < urls.length - 1) continue; // Try next URL
                            throw new Error('Registry file is empty');
                        }
                        
                        forkRegistry = parseYAML(yamlText);
                        
                        // Validate parsed data
                        if (!Array.isArray(forkRegistry) || forkRegistry.length === 0) {
                            if (urlIndex < urls.length - 1) continue; // Try next URL
                            throw new Error('No forks found in registry');
                        }
                        
                        // Validate each fork has required fields
                        forkRegistry = forkRegistry.filter(fork => {
                            if (!fork.id || !fork.name) {
                                console.warn('Skipping fork with missing id or name:', fork);
                                return false;
                            }
                            return true;
                        });
                        
                        console.log(`Successfully loaded fork registry from ${urlIndex === 0 ? 'primary' : urlIndex === 1 ? 'commit SHA' : 'API'} URL`);
                        return forkRegistry;
                    } catch (error) {
                        if (urlIndex === urls.length - 1) {
                            // Last URL failed, log error and fallback
                            console.error('Error loading fork registry from all URLs:', error);
                            break;
                        }
                        // Continue to next URL
                        console.warn(`Failed to load from URL ${urlIndex + 1}, trying next...`, error);
                    }
                }
                
                // Fallback to templates if all URLs failed
                console.warn('Falling back to template data');
                return Object.keys(forkTemplates).map(id => ({
                    id,
                    name: forkTemplates[id].name,
                    forked_from: id === 'default' ? null : 'default',
                    verified: id === 'default',
                    created_by: 'BTCDecoded',
                    tier1: forkTemplates[id].tier1.signatures,
                    tier1_review: forkTemplates[id].tier1.review,
                    tier2: forkTemplates[id].tier2.signatures,
                    tier2_review: forkTemplates[id].tier2.review,
                    tier3: forkTemplates[id].tier3.signatures,
                    tier3_review: forkTemplates[id].tier3.review,
                    tier3_veto: forkTemplates[id].tier3.veto,
                    description: forkTemplates[id].name
                }));
            }
            
            // Render marketplace cards from registry
            function renderMarketplaceCards(forks) {
                const container = document.getElementById('fork-cards');
                if (!forks || forks.length === 0) {
                    container.innerHTML = '<div class="fork-error" style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--text-secondary);">No forks found in registry.</div>';
                    return;
                }
                
                let html = '';
                forks.forEach(fork => {
                    const isDefault = fork.id === 'default';
                    const isTemplate = fork.created_by === 'BTCDecoded' && !isDefault;
                    const cardClass = isDefault ? 'featured' : (isTemplate ? 'template' : 'community');
                    const badgeClass = isDefault ? 'default' : (isTemplate ? 'template' : 'community');
                    const badgeText = isDefault ? 'Default' : (isTemplate ? 'Template' : 'Community');
                    
                    // Clean up name - remove "Governance" and "Default"
                    let displayName = fork.name || fork.id;
                    displayName = displayName.replace(/\s+Governance\s*/gi, '');
                    displayName = displayName.replace(/\s+Default\s*/gi, '');
                    if (fork.id === 'default') {
                        displayName = 'BTCDecoded';
                    }
                    
                    html += `
                        <div class="fork-card ${cardClass}" data-fork-id="${fork.id}">
                            <div class="fork-card-header">
                                <h4>${displayName}</h4>
                                <span class="fork-badge ${badgeClass}">${badgeText}</span>
                                ${fork.verified ? '<span class="fork-badge verified">‚úì Verified</span>' : ''}
                            </div>
                            <p class="fork-description">${fork.description || 'No description available'}</p>
                            <div class="fork-stats">
                                <div class="stat">
                                    <span class="stat-label">Adoption</span>
                                    <span class="stat-value">${isDefault ? '100%' : '0%'}</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Nodes</span>
                                    <span class="stat-value">${isDefault ? 'All' : '0'}</span>
                                </div>
                            </div>
                            <div class="fork-features">
                                ${fork.tier1 ? `<span class="feature-tag">Tier 1: ${fork.tier1}</span>` : ''}
                                ${fork.tier2 ? `<span class="feature-tag">Tier 2: ${fork.tier2}</span>` : ''}
                                ${fork.tier3 ? `<span class="feature-tag">Tier 3: ${fork.tier3}</span>` : ''}
                                ${fork.tier3_veto ? `<span class="feature-tag">Veto: ${fork.tier3_veto}%</span>` : ''}
                            </div>
                            <button class="btn ${isDefault ? 'btn-outline' : 'btn-primary'} fork-btn" data-fork="${fork.id}">${isDefault ? 'View Details' : 'Fork This'}</button>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // Re-attach event listeners for fork buttons
                document.querySelectorAll('.fork-btn[data-fork]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const forkId = this.getAttribute('data-fork');
                        const fork = forks.find(f => f.id === forkId);
                        if (!fork) return;
                        
                        // Switch to custom tab for all forks
                        document.querySelectorAll('.fork-tab').forEach(t => t.classList.remove('active'));
                        document.querySelector('.fork-tab[data-tab="custom"]').classList.add('active');
                        document.querySelectorAll('.fork-tab-content').forEach(c => c.classList.remove('active'));
                        document.getElementById('custom-tab').classList.add('active');
                        
                        // Load fork into custom form
                        loadForkFromRegistry(fork);
                        updateRulesetPreview();
                    });
                });
                
                // Re-attach search/filter
                const searchInput = document.getElementById('fork-search');
                const sortSelect = document.getElementById('fork-sort');
                if (searchInput && sortSelect) {
                    searchInput.addEventListener('input', () => filterAndSortForks(forks));
                    sortSelect.addEventListener('change', () => filterAndSortForks(forks));
                }
            }
            
            // Populate compare dropdowns from registry
            function populateCompareDropdowns(forks) {
                const select1 = document.getElementById('compare-fork1');
                const select2 = document.getElementById('compare-fork2');
                
                if (!select1 || !select2 || !forks || forks.length === 0) return;
                
                // Clear existing options
                select1.innerHTML = '';
                select2.innerHTML = '';
                
                // Add options
                forks.forEach(fork => {
                    const option1 = document.createElement('option');
                    option1.value = fork.id;
                    option1.textContent = fork.name || fork.id;
                    select1.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = fork.id;
                    option2.textContent = fork.name || fork.id;
                    select2.appendChild(option2);
                });
                
                // Set defaults
                if (forks.length > 0) {
                    select1.value = forks[0].id;
                    if (forks.length > 1) {
                        select2.value = forks[1].id;
                    } else {
                        select2.value = forks[0].id;
                    }
                }
                
                // Update comparison
                updateComparisonFromRegistry(forks);
            }
            
            // Load fork data into form from registry
            function loadForkFromRegistry(fork) {
                if (!fork) return;
                
                // Parse signature thresholds
                const parseSignatures = (sig) => {
                    if (!sig) return '3-of-5';
                    return sig;
                };
                
                // Set tier values with event dispatching
                const tier1Select = document.getElementById('tier1-signatures');
                tier1Select.value = parseSignatures(fork.tier1);
                tier1Select.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier1Review = document.getElementById('tier1-review');
                tier1Review.value = fork.tier1_review || 7;
                tier1Review.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier2Select = document.getElementById('tier2-signatures');
                tier2Select.value = parseSignatures(fork.tier2);
                tier2Select.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier2Review = document.getElementById('tier2-review');
                tier2Review.value = fork.tier2_review || 30;
                tier2Review.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier3Select = document.getElementById('tier3-signatures');
                tier3Select.value = parseSignatures(fork.tier3);
                tier3Select.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier3Review = document.getElementById('tier3-review');
                tier3Review.value = fork.tier3_review || 90;
                tier3Review.dispatchEvent(new Event('change', { bubbles: true }));
                
                const tier3Veto = document.getElementById('tier3-veto');
                tier3Veto.value = fork.tier3_veto || 30;
                tier3Veto.dispatchEvent(new Event('change', { bubbles: true }));
                
                // Set metadata
                document.getElementById('ruleset-name').value = fork.id + '-governance-v1';
                document.getElementById('ruleset-description').value = fork.description || `Forked from ${fork.name || fork.id}`;
            }
            
            // Update comparison using registry data
            function updateComparisonFromRegistry(forks) {
                const fork1Id = document.getElementById('compare-fork1').value;
                const fork2Id = document.getElementById('compare-fork2').value;
                
                if (!fork1Id || !fork2Id) return;
                
                if (fork1Id === fork2Id) {
                    document.getElementById('compare-results').innerHTML = '<p class="compare-error">Please select two different forks to compare.</p>';
                    return;
                }
                
                const fork1 = forks.find(f => f.id === fork1Id);
                const fork2 = forks.find(f => f.id === fork2Id);
                
                if (!fork1 || !fork2) return;
                
                // Clean up names for display
                let fork1Name = fork1.name || fork1.id;
                let fork2Name = fork2.name || fork2.id;
                fork1Name = fork1Name.replace(/\s+Governance\s*/gi, '').replace(/\s+Default\s*/gi, '');
                fork2Name = fork2Name.replace(/\s+Governance\s*/gi, '').replace(/\s+Default\s*/gi, '');
                if (fork1.id === 'default') fork1Name = 'BTCDecoded';
                if (fork2.id === 'default') fork2Name = 'BTCDecoded';
                
                // Helper function to parse signature threshold (e.g., "3-of-5")
                function parseSignatureThreshold(sig) {
                    if (!sig || sig === 'N/A') return null;
                    const match = sig.match(/(\d+)-of-(\d+)/);
                    if (!match) return null;
                    return {
                        required: parseInt(match[1]),
                        total: parseInt(match[2]),
                        ratio: parseInt(match[1]) / parseInt(match[2])
                    };
                }
                
                // Helper function to describe signature threshold differences
                function describeSignatureDiff(sig1, sig2) {
                    const parsed1 = parseSignatureThreshold(sig1);
                    const parsed2 = parseSignatureThreshold(sig2);
                    
                    if (!parsed1 || !parsed2) return 'N/A';
                    if (sig1 === sig2) return '‚Äî';
                    
                    const ratioDiff = parsed1.ratio - parsed2.ratio;
                    const requiredDiff = parsed1.required - parsed2.required;
                    const totalDiff = parsed1.total - parsed2.total;
                    
                    // More restrictive = higher ratio or same ratio but more required
                    if (ratioDiff > 0.01 || (Math.abs(ratioDiff) < 0.01 && requiredDiff > 0)) {
                        return 'More restrictive';
                    } else if (ratioDiff < -0.01 || (Math.abs(ratioDiff) < 0.01 && requiredDiff < 0)) {
                        return 'Less restrictive';
                    } else if (totalDiff !== 0) {
                        // Same ratio but different total participants
                        return 'Different size';
                    } else {
                        return 'Different';
                    }
                }
                
                // Helper function to calculate differences
                function calculateDiff(val1, val2, type = 'number') {
                    if (val1 === 'N/A' || val2 === 'N/A' || val1 === val2) {
                        return val1 === val2 ? '‚Äî' : 'N/A';
                    }
                    
                    if (type === 'number') {
                        const num1 = parseInt(val1) || 0;
                        const num2 = parseInt(val2) || 0;
                        const diff = num1 - num2;
                        if (diff === 0) return '‚Äî';
                        return diff > 0 ? `+${diff}` : `${diff}`;
                    } else if (type === 'signature') {
                        // For signature thresholds, provide descriptive differences
                        return describeSignatureDiff(val1, val2);
                    } else {
                        return val1 !== val2 ? 'Different' : '‚Äî';
                    }
                }
                
                const comparison = `
                    <table class="compare-table-content">
                        <thead>
                            <tr>
                                <th style="width: 25%;">Parameter</th>
                                <th style="width: 25%;">${fork1Name}</th>
                                <th style="width: 25%;">${fork2Name}</th>
                                <th style="width: 25%;">Difference</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Tier 1: Signature Threshold</strong></td>
                                <td>${fork1.tier1 || 'N/A'}</td>
                                <td>${fork2.tier1 || 'N/A'}</td>
                                <td class="diff-cell">${calculateDiff(fork1.tier1 || 'N/A', fork2.tier1 || 'N/A', 'signature')}</td>
                            </tr>
                            <tr>
                                <td><strong>Tier 1: Review Period</strong></td>
                                <td>${fork1.tier1_review || 'N/A'} days</td>
                                <td>${fork2.tier1_review || 'N/A'} days</td>
                                <td class="diff-cell">${calculateDiff(fork1.tier1_review || 'N/A', fork2.tier1_review || 'N/A', 'number')} ${fork1.tier1_review && fork2.tier1_review && fork1.tier1_review !== fork2.tier1_review ? 'days' : ''}</td>
                            </tr>
                            <tr>
                                <td><strong>Tier 2: Signature Threshold</strong></td>
                                <td>${fork1.tier2 || 'N/A'}</td>
                                <td>${fork2.tier2 || 'N/A'}</td>
                                <td class="diff-cell">${calculateDiff(fork1.tier2 || 'N/A', fork2.tier2 || 'N/A', 'signature')}</td>
                            </tr>
                            <tr>
                                <td><strong>Tier 2: Review Period</strong></td>
                                <td>${fork1.tier2_review || 'N/A'} days</td>
                                <td>${fork2.tier2_review || 'N/A'} days</td>
                                <td class="diff-cell">${calculateDiff(fork1.tier2_review || 'N/A', fork2.tier2_review || 'N/A', 'number')} ${fork1.tier2_review && fork2.tier2_review && fork1.tier2_review !== fork2.tier2_review ? 'days' : ''}</td>
                            </tr>
                            <tr>
                                <td><strong>Tier 3: Signature Threshold</strong></td>
                                <td>${fork1.tier3 || 'N/A'}</td>
                                <td>${fork2.tier3 || 'N/A'}</td>
                                <td class="diff-cell">${calculateDiff(fork1.tier3 || 'N/A', fork2.tier3 || 'N/A', 'signature')}</td>
                            </tr>
                            <tr>
                                <td><strong>Tier 3: Review Period</strong></td>
                                <td>${fork1.tier3_review || 'N/A'} days</td>
                                <td>${fork2.tier3_review || 'N/A'} days</td>
                                <td class="diff-cell">${calculateDiff(fork1.tier3_review || 'N/A', fork2.tier3_review || 'N/A', 'number')} ${fork1.tier3_review && fork2.tier3_review && fork1.tier3_review !== fork2.tier3_review ? 'days' : ''}</td>
                            </tr>
                            <tr>
                                <td><strong>Economic Node Veto Threshold</strong></td>
                                <td>${fork1.tier3_veto || 'N/A'}%</td>
                                <td>${fork2.tier3_veto || 'N/A'}%</td>
                                <td class="diff-cell">${calculateDiff(fork1.tier3_veto || 'N/A', fork2.tier3_veto || 'N/A', 'number')}${fork1.tier3_veto && fork2.tier3_veto && fork1.tier3_veto !== fork2.tier3_veto ? '%' : ''}</td>
                            </tr>
                        </tbody>
                    </table>
                `;
                
                document.getElementById('compare-results').innerHTML = comparison;
                
                // Add styling classes to diff cells after rendering
                setTimeout(() => {
                    document.querySelectorAll('.diff-cell').forEach(cell => {
                        const text = cell.textContent.trim();
                        if (text !== '‚Äî' && text !== 'N/A' && text !== '') {
                            cell.classList.add('has-diff');
                            // Style descriptive text differences (not numeric)
                            if (!text.match(/^[+-]?\d+/)) {
                                cell.classList.add('different-text');
                            }
                        }
                    });
                }, 0);
            }
            
            // Enhanced search and filter for registry data
            function filterAndSortForks(forks) {
                if (!forks) return;
                
                const searchTerm = document.getElementById('fork-search')?.value.toLowerCase() || '';
                const sortBy = document.getElementById('fork-sort')?.value || 'popular';
                const cards = document.querySelectorAll('.fork-card[data-fork-id]');
                
                let visibleCards = Array.from(cards).filter(card => {
                    const forkId = card.getAttribute('data-fork-id');
                    const fork = forks.find(f => f.id === forkId);
                    if (!fork) return false;
                    
                    const title = (fork.name || fork.id).toLowerCase();
                    const description = (fork.description || '').toLowerCase();
                    return title.includes(searchTerm) || description.includes(searchTerm);
                });
                
                // Sort cards
                if (sortBy === 'popular') {
                    // Default order (default first, then by verified, then by name)
                    visibleCards.sort((a, b) => {
                        const aId = a.getAttribute('data-fork-id');
                        const bId = b.getAttribute('data-fork-id');
                        const aFork = forks.find(f => f.id === aId);
                        const bFork = forks.find(f => f.id === bId);
                        
                        if (aId === 'default') return -1;
                        if (bId === 'default') return 1;
                        if (aFork?.verified && !bFork?.verified) return -1;
                        if (!aFork?.verified && bFork?.verified) return 1;
                        return (aFork?.name || aId).localeCompare(bFork?.name || bId);
                    });
                } else if (sortBy === 'recent') {
                    visibleCards.sort((a, b) => {
                        const aId = a.getAttribute('data-fork-id');
                        const bId = b.getAttribute('data-fork-id');
                        const aFork = forks.find(f => f.id === aId);
                        const bFork = forks.find(f => f.id === bId);
                        const aDate = aFork?.created_at || '';
                        const bDate = bFork?.created_at || '';
                        return bDate.localeCompare(aDate);
                    });
                } else if (sortBy === 'conservative') {
                    visibleCards.sort((a, b) => {
                        const aId = a.getAttribute('data-fork-id');
                        const bId = b.getAttribute('data-fork-id');
                        const aFork = forks.find(f => f.id === aId);
                        const bFork = forks.find(f => f.id === bId);
                        // Higher tier3 review = more conservative
                        return (bFork?.tier3_review || 0) - (aFork?.tier3_review || 0);
                    });
                }
                
                // Hide all, then show filtered
                cards.forEach(card => {
                    card.style.display = 'none';
                });
                visibleCards.forEach(card => {
                    card.style.display = 'block';
                });
            }
            
            // Render Genealogy Tree
            function renderGenealogyTree(forks) {
                const container = document.getElementById('genealogy-tree');
                if (!forks || forks.length === 0) {
                    container.innerHTML = '<p class="genealogy-error">No forks found in registry.</p>';
                    return;
                }
                
                // Build tree structure
                const forkMap = new Map();
                const rootForks = [];
                
                forks.forEach(fork => {
                    forkMap.set(fork.id, fork);
                });
                
                forks.forEach(fork => {
                    if (!fork.forked_from || !forkMap.has(fork.forked_from)) {
                        if (!fork.forked_from) rootForks.push(fork);
                    }
                });
                
                // If no root, use first fork
                if (rootForks.length === 0 && forks.length > 0) {
                    rootForks.push(forks.find(f => f.id === 'default') || forks[0]);
                }
                
                function renderForkNode(fork, level = 0) {
                    const isRoot = level === 0;
                    const children = forks.filter(f => f.forked_from === fork.id);
                    const forkType = fork.verified ? 'verified' : (fork.id === 'default' ? 'default' : (fork.created_by === 'BTCDecoded' ? 'template' : 'community'));
                    
                    // Clean up name - remove "Governance" and "Default"
                    let displayName = fork.name || fork.id;
                    displayName = displayName.replace(/\s+Governance\s*/gi, '');
                    displayName = displayName.replace(/\s+Default\s*/gi, '');
                    if (fork.id === 'default') {
                        displayName = 'BTCDecoded';
                    }
                    
                    let html = `
                        <div class="genealogy-node ${forkType}" data-level="${level}">
                            <div class="genealogy-node-content">
                                <div class="genealogy-node-header">
                                    <h4>${displayName}</h4>
                                    ${fork.verified ? '<span class="genealogy-badge verified">‚úì Verified</span>' : ''}
                                    ${fork.id === 'default' ? '<span class="genealogy-badge default">Root</span>' : ''}
                                </div>
                                <p class="genealogy-node-desc">${fork.description || 'No description'}</p>
                                <div class="genealogy-node-details">
                                    <span class="genealogy-detail">T1: ${fork.tier1 || 'N/A'}</span>
                                    <span class="genealogy-detail">T2: ${fork.tier2 || 'N/A'}</span>
                                    <span class="genealogy-detail">T3: ${fork.tier3 || 'N/A'}</span>
                                    ${fork.created_by ? `<span class="genealogy-detail">By: ${fork.created_by}</span>` : ''}
                                </div>
                                ${fork.github ? `<a href="${fork.github}" target="_blank" class="genealogy-link">View on GitHub ‚Üí</a>` : ''}
                            </div>
                    `;
                    
                    if (children.length > 0) {
                        html += '<div class="genealogy-children">';
                        children.forEach(child => {
                            html += renderForkNode(child, level + 1);
                        });
                        html += '</div>';
                    }
                    
                    html += '</div>';
                    return html;
                }
                
                let treeHTML = '<div class="genealogy-tree-root">';
                rootForks.forEach(root => {
                    treeHTML += renderForkNode(root, 0);
                });
                treeHTML += '</div>';
                
                container.innerHTML = treeHTML;
            }
            
            // Load and render genealogy on tab switch
            let genealogyLoaded = false;
            document.querySelectorAll('.fork-tab').forEach(tab => {
                tab.addEventListener('click', async function() {
                    const targetTab = this.getAttribute('data-tab');
                    if (targetTab === 'genealogy' && !genealogyLoaded) {
                        document.getElementById('genealogy-status').textContent = 'Loading forks from registry...';
                        const forks = await loadForkRegistry();
                        renderGenealogyTree(forks);
                        genealogyLoaded = true;
                        document.getElementById('genealogy-status').textContent = `Loaded ${forks.length} fork(s) from registry`;
                    }
                });
            });
            
            // Refresh button
            document.getElementById('genealogy-refresh').addEventListener('click', async function() {
                genealogyLoaded = false;
                document.getElementById('genealogy-status').textContent = 'Refreshing...';
                const forks = await loadForkRegistry();
                renderGenealogyTree(forks);
                document.getElementById('genealogy-status').textContent = `Loaded ${forks.length} fork(s) from registry`;
            });
            
            // Share Your Fork functionality
            document.getElementById('share-fork').addEventListener('click', function() {
                const ruleset = updateRulesetPreview();
                const rulesetName = document.getElementById('ruleset-name').value || 'my-custom-governance';
                const rulesetVersion = document.getElementById('ruleset-version').value || '1.0.0';
                const rulesetDescription = document.getElementById('ruleset-description').value || 'Custom governance ruleset';
                
                // Determine parent fork (if forked from a template)
                let parentFork = null;
                const currentTier1 = document.getElementById('tier1-signatures').value;
                const currentTier2 = document.getElementById('tier2-signatures').value;
                const currentTier3 = document.getElementById('tier3-signatures').value;
                
                // Check which template matches
                for (const [id, template] of Object.entries(forkTemplates)) {
                    if (template.tier1.signatures === currentTier1 && 
                        template.tier2.signatures === currentTier2 && 
                        template.tier3.signatures === currentTier3) {
                        parentFork = id;
                        break;
                    }
                }
                if (!parentFork) parentFork = 'default';
                
                // Generate YAML entry
                const forkId = rulesetName.toLowerCase().replace(/[^a-z0-9-]/g, '-');
                const today = new Date().toISOString().split('T')[0];
                
                const yamlEntry = `  - id: ${forkId}
    name: ${rulesetName}
    description: ${rulesetDescription}
    forked_from: ${parentFork}
    created_by: YOUR_GITHUB_USERNAME
    github: https://github.com/YOUR_USERNAME/YOUR_REPO
    ruleset_url: https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/governance-ruleset.json
    tier1: "${currentTier1}"
    tier1_review: ${document.getElementById('tier1-review').value}
    tier2: "${currentTier2}"
    tier2_review: ${document.getElementById('tier2-review').value}
    tier3: "${currentTier3}"
    tier3_review: ${document.getElementById('tier3-review').value}
    tier3_veto: ${document.getElementById('tier3-veto').value}
    verified: false
    created_at: "${today}"`;
                
                // Show share modal
                const modal = document.createElement('div');
                modal.className = 'deployment-modal';
                modal.style.cssText = 'position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;';
                
                modal.innerHTML = `
                    <div class="deployment-modal-content" style="background-color: var(--bg-primary); margin: 2rem; padding: 2rem; border-radius: 8px; max-width: 700px; max-height: 90vh; overflow-y: auto; position: relative;">
                        <button class="deployment-modal-close" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);">&times;</button>
                        <h3 style="margin-top: 0;">üå≥ Share Your Fork to the Commons</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Add your fork to the public registry so others can discover and use it. Follow these steps:</p>
                        
                        <div class="deployment-steps">
                            <div class="deployment-step">
                                <h4>1. Fork the governance repository</h4>
                                <div class="code-block">
                                    <code>gh repo fork BTCDecoded/governance</code>
                                    <button class="copy-btn" data-copy="gh repo fork BTCDecoded/governance">Copy</button>
                                </div>
                                <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Or use the GitHub web interface to fork <a href="https://github.com/BTCDecoded/governance" target="_blank">BTCDecoded/governance</a></p>
                            </div>
                            
                            <div class="deployment-step">
                                <h4>2. Edit fork-registry.yml</h4>
                                <p>Add this entry to <code>governance/fork-registry.yml</code>:</p>
                                <div class="code-block" style="position: relative;">
                                    <pre style="margin: 0; padding: 1rem; background: var(--bg-secondary); border-radius: 4px; overflow-x: auto; font-size: 0.85rem;"><code>${yamlEntry}</code></pre>
                                    <button class="copy-btn" style="position: absolute; top: 0.5rem; right: 0.5rem;" data-copy="${yamlEntry.replace(/`/g, '\\`')}">Copy</button>
                                </div>
                                <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;"><strong>Important:</strong> Replace <code>YOUR_GITHUB_USERNAME</code>, <code>YOUR_USERNAME</code>, and <code>YOUR_REPO</code> with your actual values.</p>
                            </div>
                            
                            <div class="deployment-step">
                                <h4>3. Commit and push</h4>
                                <div class="code-block">
                                    <code>git add governance/fork-registry.yml
git commit -m "Add my fork: ${rulesetName}"
git push origin main</code>
                                    <button class="copy-btn" data-copy="git add governance/fork-registry.yml\ngit commit -m \"Add my fork: ${rulesetName}\"\ngit push origin main">Copy</button>
                                </div>
                            </div>
                            
                            <div class="deployment-step">
                                <h4>4. Create a pull request</h4>
                                <p>Go to <a href="https://github.com/BTCDecoded/governance/compare" target="_blank">GitHub's compare page</a> and create a PR from your fork.</p>
                                <p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Automated validation will check your entry. If it passes, your PR will be merged automatically!</p>
                            </div>
                        </div>
                        
                        <div class="deployment-note" style="margin-top: 1.5rem; padding: 1rem; background-color: var(--bg-secondary); border-radius: 6px; border-left: 3px solid var(--bitcoin-orange);">
                            <p style="margin: 0;"><strong>üí° Remember:</strong> This is a permissionless, self-service registry. No approval needed‚Äîjust follow the format and automated validation will handle the rest.</p>
                        </div>
                        
                        <div class="deployment-actions" style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="this.closest('.deployment-modal').remove()">Got it!</button>
                            <a href="https://github.com/BTCDecoded/governance/blob/main/fork-registry.yml" target="_blank" class="btn btn-outline">View Registry</a>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Close button
                modal.querySelector('.deployment-modal-close').addEventListener('click', () => modal.remove());
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });
                
                // Copy buttons
                modal.querySelectorAll('.copy-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const code = this.getAttribute('data-copy');
                        navigator.clipboard.writeText(code).then(() => {
                            const originalText = this.textContent;
                            this.textContent = 'Copied!';
                            setTimeout(() => {
                                this.textContent = originalText;
                            }, 2000);
                        });
                    });
                });
            });
        });
    </script>
</body>
</html>

